/**
 * Created by w44 on 15-2-6.
 */


var CronJob = require('cron').CronJob;

var util = require('print_util');
var log=util.log;

var assist = require('print_assist');
var queryAssist=assist.queryAssist;

var memory = require('print_memory');
var webIo = memory.webIo;

var PageControl = function(){};


PageControl.prototype.run=function(){
    var self=this;
    //等待队列消息
    self.waitQueen.start();
    self.terminalCount.start();
};


PageControl.prototype.waitQueen= new CronJob('*/5 * * * * *', function () {
    log.info("通知等待队列消息");
    queryAssist.getWaitQueen(function(err,termInfo){
        if(err){
           log.error(err);
        }else{
            webIo.io.emit('waitQueen',termInfo);
        }
    });
}, null, true, 'Asia/Chongqing');

PageControl.prototype.terminalCount= new CronJob('*/10 * * * * *', function () {
    log.info("通知终端机票数量消息");
    queryAssist.getTerminalCount(function(err,body){
        if(err){
            log.error(err);
        }else{
            webIo.io.emit('terminalCount',body);
        }
    });
}, null, true, 'Asia/Chongqing');





var pageControl = new PageControl();
module.exports = pageControl;





